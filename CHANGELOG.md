# Changelog

本项目的所有关键更改都将记录在此文件中。

## [Alpha.12]

### 🐛 Bug Fixes (修复)
- **command**: 修复 `stock buy` 等指令在通过主命令转发时，因 `session.user` 未加载导致 UID 识别为 0 的问题。 ([#1](https://github.com/BYWled/koishi-plugin-monetary-bourse/issues/1))

## [Alpha.11]

### ⚡ Performance (性能优化)
- **alg**: 提升随机噪声强度，优化价格波动表现。

### 🐛 Bug Fixes (修复)
- **render**: 修复末尾渲染部分的语法错误。

### ✨ Features (新特性)
- **logging**: 在支付逻辑、交易处理、指令校验和图片渲染函数中添加详细的日志记录，包含警告和错误级别输出。

## [2.0.2]

### 📝 Documentation (文档)
- 同步更新 Gitee 和 Github 链接至 `README`。

## [2.0.1]

### 🐛 Bug Fixes (修复)
- **build**: 修复构建流程，将静态 HTML 模板正确打包进 `lib` 目录，解决插件更新后未更新静态页面的问题。

## [2.0.0]

### 💄 UI/UX (界面与交互)
- **layout**: 重构交易详情页布局，分离股票信息与价格展示区域，底部改为 Grid 布局，增加页面外间距至 64px。
- **display**: 优化状态徽标逻辑，支持「交易方向」与「挂单中」状态并列显示，新增 Pending 呼吸动画。
- **typography**: 显著增大详情页关键数值与标签字号，强制使用 Roboto Mono 等宽字体，提升金融专业感。

### ⚡ Performance (性能优化)
- **alg**: 提升随机噪声强度，使实时曲线更具呼吸感，减少单调走势。

### 🐛 Bug Fixes (修复)
- **trade**: 修复交易结果回单在存在冻结时间时未能即时弹出的问题。
- **ui**: 修正时间戳位置，强制固定于页面右下角。

## [Alpha.10]

### ✨ Features (新特性)
- **core**: 引入 25 种全新 K 线形态库（包含红三兵、黑三鸦等）。
- **core**: 新增 `selectPatternByExpectation` 智能调度算法，根据价格偏离度动态调整形态概率，实现“估值修复”。
- **ui**: 新增可视化交易交割单（成交结算图）。
- **ui**: HTML 模板化重构，支持高分辨率渲染。

### ⚡ Performance (性能优化)
- 优化持仓成本计算逻辑。
- 优化挂单排队体验。
- 优化旧版本数据兼容性处理。

## [Alpha.9]

### 🐛 Bug Fixes (修复)
- **build**: 修复构建遗漏，将静态 HTML 打包进 `lib`，解决插件无法加载模板的问题。

## [Alpha.8]

### ✨ Features (新特性)
- **ui**: 提取并模板化走势图 (`stock-chart.html`)。
- **queue**: 实现用户级串行挂单排队机制，防止拆单规避冻结时长（T+0 防绕过）。

### 💄 UI/UX (界面与交互)
- 全面优化走势图视觉效果（深色玻璃拟态、坐标轴优化、字体增强）。

### ⚡ Performance (性能优化)
- **alg**: 提升基础波动率与形态影响力，改进周波浪与均值回归。
- **dev**: 新增 `enableDebug` 调试开关。

## [Alpha.7]

### ✨ Features (新特性)
- **model**: 引入几何布朗运动 + 均值回归算法，添加正态分布噪声与软着陆限幅，提高日内波动拟真度。

## [Alpha.6]

### ♻️ Refactor (重构)
- 采用百分比波动合成模型，解决长期振幅失控问题并提升稳定性。

### 🐛 Bug Fixes (修复)
- 修正手动宏观调控在部分场景下重置基准价的问题。

## [Alpha.5]

### ♻️ Refactor (重构)
- 重写走势引擎为绝对价格合成模式（基准价 + 趋势 + 日内波动 + 周波浪 + 噪声）。
- 强化 ±50% 涨跌幅限幅逻辑。

## [1.1.1 (Alpha.4)]

### ✨ Features (新特性)
- 引入硬性 ±50% 涨跌幅上限。
- 增加随机刷新宏观目标机制，增强稳定性与随机性。
- 新增调试命令用于验证逻辑。

### 🐛 Bug Fixes (修复)
- 修复在更新负载中修改主键导致的数据库错误。
- 移除过时的手动控制配置项。

## [1.1.0 (Alpha.3)]

### ✨ Features (新特性)
- 新增持仓盈亏追踪。
- 新增持仓成本追踪 (`totalCost`)。
- 新增持仓卡片渲染功能。

### 🐛 Bug Fixes (修复)
- 统一系统内金额与价格为两位小数，保证精度与兼容性。
- 修复 `maxFreezeTime = 0` 时交易未能即时完成的问题。

## [1.0.0]

### 🐛 Bug Fixes (修复)
- 修复因更新负载包含主键而导致的 `TypeError: cannot modify primary key`，提高数据库兼容性。

## [Alpha.2]

### ✨ Features (新特性)
- 扩展日内走势剧本并叠加周级波浪。
- 改进 Puppeteer 渲染，减少横轴标签重叠。

### 📝 Notes (说明)
- 历史版本曾存在主键相关问题，后续版本已修复。

## [Alpha.1]

### 🎉 Initial Release (初始发布)
- 实现股票买卖基础功能。
- 实现挂单与资金冻结机制。
- 实现历史行情存储。
- 实现 `stock` 系列基础指令。
- 支持 `monetary` / `monetary-bank` 联动。